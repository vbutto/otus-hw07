<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <title>Weather demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 0 16px
        }

        pre {
            background: #f6f8fa;
            padding: 12px;
            border-radius: 8px;
            overflow: auto
        }
    </style>
</head>

<body>
    <h1>Weather demo</h1>
    <p>Получаю координаты и запрашиваю прогноз через API Gateway…</p>
    <pre id="out">Жду геолокацию…</pre>
    <script>
        (async () => {
            const out = document.getElementById('out');
            try {
                const pos = await new Promise((res, rej) =>
                    navigator.geolocation.getCurrentPosition(res, rej, { timeout: 5000 }));
                const lat = pos.coords.latitude, lon = pos.coords.longitude;
                const url = '${api_gateway_url}/weather?lat=' + lat.toFixed(4) + '&lon=' + lon.toFixed(4) + '&days=3';
                out.textContent = 'GET ' + url;
                const r = await fetch(url);
                const j = await r.json();
                out.textContent = JSON.stringify(j, null, 2);
            } catch (e) {
                out.textContent = 'Ошибка: ' + e;
            }
        })();
    </script>
</body>

</html>